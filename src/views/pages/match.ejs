<%- include('../partials/header', { pageTitle: 'Match | PolyCOOP' }) %>
       
        <main>
            <div class="center-content">
            <% if (users && users.length > 0) { %>
            <div class="match-card">
                <div class="card-details">
                    <img src="uploads/<%= users[0].profileImage %>" alt="Profile Image" class="card-image">
                    <div class="card-info">
                    <p class="card-username"><%= users[0].username %></p>
                    <p><%= users[0].age %> years old</p>
                    <p><%= users[0].description %></p>
                    </div>
                </div>
                <div class="card-buttons">
                    <button class="skip-btn" onclick="skipProfile()"><img src="/img/skip.png" class="skip-btn-decoration"> Skip</button>
                    <button class="match-btn" onclick="matchProfile()"><img src="/img/logowhite.png" class="match-btn-decoration"> Match</button>
                </div>
            </div>
            <% } else { %>
                <div class="no-users">
                    <p>Brak dostępnych profili do wyświetlenia!</p>
                    <a href="/">Wróć do strony głównej</a>
                </div>
            <% } %>
            </div>
        </main>

        <%- include('../partials/footer') %>

        <script>
            let currentIndex = 0;
            const allUsers = <%-JSON.stringify(users) %>; 
            
            function sendMatchRequest(userId) { // wysyla post request do serwera z id uzytkownika pod /match
                fetch('/match', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ matchedUserId: userId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Match recorded successfully');
                    } else {
                        console.error('Error recording match');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
            function showNoUsers() {
               const main = document.querySelector('main');
               main.innerHTML = `
                  <div class="no-users">
                     <p>Brak dostępnych profili do wyświetlenia!</p>
                    <a href="/">Wróć do strony głównej</a>
                </div>
              `;
}

function matchProfile() {
    if (currentIndex < allUsers.length) {
        sendMatchRequest(allUsers[currentIndex]._id); 
        currentIndex++;
        if (currentIndex < allUsers.length) {
            loadProfile(); 
        } else {
            showNoUsers(); 
        }
    }
}
function skipProfile() {
    if (currentIndex < allUsers.length - 1) {
        currentIndex++;
        loadProfile();
    } else {
        showNoUsers();
    }
}


            function loadProfile() {
                const user = allUsers[currentIndex];
                const profileCard = document.querySelector('.profile-card');
                if (profileCard && user) {
                    profileCard.innerHTML = `
                        <p class="username">${user.username}</p>
                        <p><strong>Wiek:</strong> ${user.age} lat</p>
                        <p><strong>Opis:</strong> ${user.description}</p>
                    `;
                }
            }
        </script>
